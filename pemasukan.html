<!DOCTYPE html>
<html lang="id">
<head>
<link href='https://short-url.org/1pNvK.png' rel='icon' type='image/png'/>
<link href='https://short-url.org/1pNvK.png' rel='icon' sizes='192x192'/>
<link href='https://short-url.org/1pNvK.png' rel='apple-touch-icon' sizes='180x180'/>
    
<meta content='https://short-url.org/1pNvK' name='msapplication-TileImage'/>
<meta content='#00a2e9' name='theme-color'/> 
<meta content='#00a2e9' name='theme-color'/>
<meta content='#00a2e9' name='msapplication-navbutton-color'/>
<meta content='yes' name='mobile-web-app-capable'/>
<meta content='#00a2e9' name='apple-mobile-web-app-status-bar-style'/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/finansial148/editorgue@main/style-pusat.css">
    <title>Pemasukan Harian</title>
<style>
  .kotak-msk{display: flex; justify-content: space-between; align-items: center; padding: 10px 5px; border-bottom: 1px solid #00000029;}
  .hal-msk{display: flex; flex-direction: column; flex-grow: 1;}
  .isi1-msk{font-size: 0.8rem; color: gray;}
  .isi2-msk{font-weight: bold;}
  .nomin-msk{text-align: right; display: flex; align-items: center; gap: 10px;}
  .nomin-msk span {font-weight: bold; color: #2e7d32;}
  .nomin-msk button {background: #ff4444; color: white; border: none; border-radius: 4px; padding: 2px 8px; cursor: pointer; font-size: 12px;}
</style>
  </head>
  <body>
<div class="container">
    <h2>Laporan Pemasukan Harian</h2>
    
    <div style="margin-bottom: 20px;">
        <input type="text" id="mNama" placeholder="Keterangan Manual">
        <input type="number" id="mTotal" placeholder="Nominal">
        <button onclick="inputManual()">Tambah</button>
    </div>
        <div id="bodyTabel"></div>
    <h3 id="totalSemua">Total: Rp 0</h3>
    
    <button onclick="hapusSemua()" style="color:red; margin-top:20px;">Kosongkan Laporan</button>
  <button onclick="kirimKeBulanan()" style="color:red; margin-top:20px;">kirimKeBulanan</button>
  <button onclick="prosesBackup()" style="background-color: #4285F4; color: white; padding: 10px; border: none; border-radius: 5px; margin-top: 10px;">
    <i class="fa fa-cloud-upload"></i> Simpan ke Cloud (Drive)
</button>
</div>
    <div class="bottom-nav">
    <a href="index.html" class="nav-item">
        <i class="fa fa-home"></i>
        <span>Home</span>
    </a>
    <a href="pemasukan.html" class="nav-item">
        <i class="fas fa-hand-holding-usd"></i>
        <span>Masukan</span>
    </a>
    <a href="pengluaran.html" class="nav-item">
        <i class="fas fa-shopping-cart"></i>
        <span>Keluaran</span>
    </a>
    <a href="bagihasil.html" class="nav-item active">
        <i class="fas fa-chart-pie"></i>
        <span>Laba</span>
    </a>
    <a href="arsip.html" class="nav-item">
        <i class="fa fa-archive"></i>
        <span>Arsip</span>
    </a>
</div>
<script>
// Ambil data dari LocalStorage saat halaman dibuka
let dataPemasukan = JSON.parse(localStorage.getItem('database_pemasukan')) || [];

window.onload = function() {
    // 1. CEK APAKAH ADA KIRIMAN DARI NOTA LEWAT URL
    const params = new URLSearchParams(window.location.search);
    const namaNota = params.get('nama');
    const totalNota = params.get('total');

    if (namaNota && totalNota) {
        simpanData(namaNota, totalNota);
        // Hilangkan parameter di URL biar kalau direfresh nggak masuk dua kali
        window.history.replaceState({}, document.title, window.location.pathname);
    }

    tampilkanData();
};

// Fungsi untuk simpan ke array dan LocalStorage
function simpanData(ket, nominal) {
    let tgl = new Date().toLocaleDateString('id-ID'); 
    
    // BERSIHKAN TITIK: Kita hapus semua titik agar "30.000" jadi "30000"
    let angkaBersih = nominal.toString().replace(/\./g, "");
    
    dataPemasukan.unshift({
        tanggal: tgl,
        keterangan: ket,
        jumlah: parseInt(angkaBersih) // Sekarang sudah jadi 30000 murni
    });

    localStorage.setItem('database_pemasukan', JSON.stringify(dataPemasukan));
    tampilkanData();
}

// Fungsi Input Manual
function inputManual() {
    let ket = document.getElementById('mNama').value;
    let nom = document.getElementById('mTotal').value;
    if(ket && nom) {
        simpanData(ket, nom);
        document.getElementById('mNama').value = "";
        document.getElementById('mTotal').value = "";
    }
}

// Fungsi Menampilkan ke Tabel
function tampilkanData() {
    let html = "";
    let totalSeluruhnya = 0;

    dataPemasukan.forEach((item, index) => { // Kita tambah 'index' di sini
        html += `
        <div class="kotak-msk">
            <div class="hal-msk">
                <span class="isi1-msk">${item.tanggal}</span>
                <span class="isi2-msk">${item.keterangan}</span>
            </div>
            
            <div class="nomin-msk">
                <span>Rp ${item.jumlah.toLocaleString()}</span>
                
                <button onclick="hapusBaris(${index})">
                    X
                </button>
            </div>
        </div>`;
        totalSeluruhnya += item.jumlah;
    });

    document.getElementById('bodyTabel').innerHTML = html;
    document.getElementById('totalSemua').innerText = "Total: Rp " + totalSeluruhnya.toLocaleString();
}
  
function hapusBaris(index) {
    if (confirm("Hapus catatan ini?")) {
        // 1. Hapus 1 item pada posisi index tertentu
        dataPemasukan.splice(index, 1);
        
        // 2. Simpan ulang perubahan ke LocalStorage
        localStorage.setItem('database_pemasukan', JSON.stringify(dataPemasukan));
        
        // 3. Tampilkan data terbaru
        tampilkanData();
    }
}  

function hapusSemua() {
    if(confirm("Yakin mau hapus semua laporan bulan ini?")) {
        localStorage.removeItem('database_pemasukan');
        dataPemasukan = [];
        tampilkanData();
    }
}
  function kirimKeBulanan() {
    // Ambil nilai dari h3 (kita bersihkan teks 'Total: Rp' dan titik-titiknya)
    let totalTeks = document.getElementById('totalSemua').innerText;
    let angkaSaja = totalTeks.replace(/[^0-9]/g, ''); 
    
    // Ambil bulan & tahun saat ini untuk label
    let d = new Date();
    let namaBulan = d.toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
    let tglLengkap = d.getDate() + "/" + namaBulan;

    // Kirim ke halaman bulanan via URL
    window.location.href = "https://catetanduit.github.io/catetanduit/pemasukan-bulanan.html?bulan=" + encodeURIComponent(tglLengkap) + "&total=" + angkaSaja;
}
  
  function prosesBackup() {
    let dataHarian = localStorage.getItem('database_pemasukan');
    
    if (!dataHarian || dataHarian === "[]") {
        alert("Nggak ada data yang bisa di-backup, Bang!");
        return;
    }

    // Untuk sementara, sebelum kita pasang API Google Drive yang asli, 
    // kita simulasikan prosesnya dulu.
    console.log("Menyiapkan paket data untuk diupload...");
    
    // Nanti di sini kita akan panggil fungsi upload ke Drive
    alert("Data siap di-arsipkan! (Langkah selanjutnya: Menyambungkan ke Google Drive API)");
}
</script>
    </body>

  </html>

